{% extends 'base.html' %}
{% block body %}
{% load static %}


<!--------------- header-section --------------->
{% include 'header.html' %}
<!--------------- header-section-end --------------->

<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
    }
    .container {
        padding: 15px;
    }
    .form-control {
        height: 3rem;
        font-size: 1.2rem;
        color: rgba(200, 28, 154, 4.08) 
   }
   .heading
   {
    font-size: 5rem;
   }
    .hidden {
        display: none;
    }
    .centered-content {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100px;
    }
    .category-selection {
        margin-top: 20px;
        text-align: center;
    }
    .specsTable {
        font-size: 1.5rem;
    }
    .wrapper-content {
        height: 50px;
        min-height: 50px;
        max-height: 50px;
    }
    .footer {
        margin-top: auto;
        width: 100%;
        background-color: #f5f5f5;
    }
    .specsRow{
        min-height: 150px;
        height: 150px;
        max-height: 150px;
        overflow-y: scroll;
    }

</style>

<body>

<!--------------- Category-selection-section --------------->
<section class="category-selection">
    <div class="container centered-content">
        <div>
            <h1 class="heading">Category</h1>
            <p>Select a category</p>
            <select id="categorySelect" class="form-control">
                <option value="">Select Category</option>
                <option value="MobilePhone">Mobiles</option>
                <option value="Laptop">Laptops</option>
                <option value="SmartWatch">Smart Watches</option>
                <option value="BTspeaker">Speakers</option>
                <option value="WirelessEarbuds">Earbuds</option>
                <option value="TV">TVs</option>
                <option value="PowerBank">PowerBanks</option>
                <option value="Tablet">Tablets</option>
            </select>
        </div>
    </div>
</section>
<!--------------- Category-selection-section end--------------->


<!--------------- Dynamic Sections Initially Hidden --------------->
<div id="dynamicContent" class="hidden">

    <!--------------- blog-tittle-section---------------->
    <section class="blog about-blog">
        <div class="container">
            <div class="blog-bradcrum">
                <span><a href="{% url  'home:home' %}">Home</a></span>
                <span class="devider">/</span>
                <span><a href="#">Compare</a></span>
            </div>
            <div class="blog-heading">
                <h1 class="heading">Product Comparison</h1>
            </div>
        </div>
    </section>
    <!--------------- blog-tittle-section-end---------------->

    <!--------------- comaprison-section---------------->
    <section class="product-cart product product-compair footer-padding">
        <div class="container">
            <div class="cart-section">
                <table>
                    <tbody>
                        <tr class="cart-top" style="border: 1px solid #ddd;">
                            <td class=" cart-item cart-grey-bg vertical-cart">
                                <div class="wrapper-title">
                                    <h5 class="comment-title">Product Comparison</h5>
                                    <p class="paragraph">Select products to see the differences and similarities between them</p>
                                </div>
                            </td>
                            <td class="cart-center cart-item" style="border: 1px solid #ddd;">
                                <div class="text-center "><h4>Product 1</h4></div>
                                
                                <div class="wrapper-data" >
                                    <div class="search">
                                        <input list="datalist1" style="border-radius: 5px; border: 1px solid black; padding: 1px; margin: 1px;" id="product1" type="text">
                                        <datalist id="datalist1"></datalist>
                                        <div>
                                            <button class="shop-btn" style="margin-left: 15px; padding: 5px 10px; font-size: 14px; flex-shrink: 0;" id="product1_btn">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                
                                    <div class="wrapper">
                                        <div>
                                            <img id="product1_img" alt="" style="width: 250px; height: 250px;" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                                        </div>
                                        <div class="wrapper-content">
                                            <h5 class="wrapper-details" id="product1_name"></h5>
                                            <div class="price">
                                                <span class="new-price" id="product1_price"></span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </td>
                            <td class="cart-center cart-item" style="border: 1px solid #ddd;">
                                <div class="text-center "><h4>Product 2</h4></div>

                                <div class="wrapper-data">
                                    <div class="search">
                                        <input list="datalist2" style="border-radius: 5px; border: 1px solid black; padding: 1px; margin: 1px;" id="product2" type="text">
                                        <datalist id="datalist2"></datalist>
                                        <div>
                                            <button class="shop-btn" style="margin-left: 15px; padding: 5px 10px; font-size: 14px; flex-shrink: 0;" id="product2_btn">
                                                <i class="fas fa-search"></i>

                                            </button>
                                        </div>
                                    </div>
                                    <div class="wrapper">
                                        <div>
                                            <img id="product2_img" alt="" style="width: 250px; height: 250px;" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                                        </div>
                                        <div class="wrapper-content">
                                            <h5 class="wrapper-details" id ="product2_name" ></h5>
                                            <div class="price">
                                                <span class="new-price" id ="product2_price"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td class="cart-center cart-item" style="border: 1px solid #ddd;">
                                <div class="text-center "><h4>Product 3</h4></div>

                                <div class="wrapper-data">
                                    <div class="search">
                                        <input list="datalist3" style="border-radius: 5px; border: 1px solid black; padding: 1px; margin: 1px;" id="product3" type="text">
                                        <datalist id="datalist3"></datalist>
                                        <div>

                                            <button class="shop-btn" style="margin-left: 15px; padding: 5px 10px; font-size: 14px; flex-shrink: 0;" id="product3_btn">
                                                <i class="fas fa-search"></i>

                                            </button>
                                        </div>
                                    </div>
                                    <div class="wrapper">
                                        <div>
                                            <img id="product3_img" alt="" style="width: 250px; height: 250px;" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                                        </div>
                                        <div class="wrapper-content">
                                            <h5 class="wrapper-details" id ="product3_name" ></h5>
                                            <div class="price">
                                                <span class="new-price" id ="product3_price"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="cart-top cart-bottom " style="border: 1px solid #ddd;">
                            <td class=" cart-item cart-grey-bg" style="border: 1px solid #ddd;">
                                <div class="wrapper-title">
                                    <h5 class="comment-title">Specification</h5>
                                </div>
                            </td>
                            <td class=" cart-item" style="border: 1px solid #ddd;">
                                <div id="product1_specs" class="wrapper-data">
                                    <table class="table specsTable"></table>

                                </div>
                            </td>
                            <td class=" cart-item" style="border: 1px solid #ddd;" >
                                <div id="product2_specs" class="wrapper-data">
                                    <table class="table specsTable " >
                                        <tbody>

                                        </tbody>
                                    </table>
                                </div>
                            </td>
                            <td class=" cart-item">
                                <div  id="product3_specs" class="wrapper-data">
                                    <table class="table specsTable">

                                    </table>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <!--------------- comaprison-section---------------->
</div>
</body>

       <!--------------- footer-section--------------->
<div class="footer">
    {% include 'footer.html' %}
</div>
       <!--------------- footer-section-end--------------->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/js/selectize.min.js"
    integrity="sha512-IOebNkvA/HZjMM7MxL0NYeLYEalloZ8ckak+NDtOViP7oiYzG5vn6WVXyrJDiJPhl4yRdmNAG49iuLmhkUdVsQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const categorySelect = document.getElementById('categorySelect');
        const dynamicContent = document.getElementById('dynamicContent');
        const dataList1 = document.getElementById('datalist1');
        const dataList2 = document.getElementById('datalist2');
        const dataList3 = document.getElementById('datalist3');

        
        categorySelect.addEventListener('change', function() {
            clearData();

            if (this.value) {
                const categoryUrl = `{% url 'allProdNamesByCategory' 'CATEGORY_PLACEHOLDER' %}`.replace('CATEGORY_PLACEHOLDER', this.value);

                fetchCategoryProducts(categoryUrl);
                dynamicContent.classList.remove('hidden');
            } else {
                dynamicContent.classList.add('hidden');
            }
        });
        async function fetchCategoryProducts(categoryUrl) {
        try {
            
            const response = await fetch(categoryUrl);
            const data = await response.json();

            // Clear existing options
            dataList1.innerHTML = '';
            dataList2.innerHTML = '';
            dataList3.innerHTML = '';

            data.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                dataList1.appendChild(option.cloneNode(true));
                dataList2.appendChild(option.cloneNode(true));
                dataList3.appendChild(option.cloneNode(true));
            });
        } catch (error) {
            console.error('Error fetching product names:', error);
        }
    }
   
   
    function clearData() {
    dataList1.innerHTML = '';
    dataList2.innerHTML = '';
    dataList3.innerHTML = '';
    // Clear input fields for each product
    document.getElementById('product1').value = '';
    document.getElementById('product2').value = '';
    document.getElementById('product3').value = '';
    ['product1', 'product2', 'product3'].forEach(num => {
        document.getElementById(`${num}_img`).src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
        document.getElementById(`${num}_name`).textContent = '';
        document.getElementById(`${num}_price`).textContent = '';
        const table = document.querySelector(`#${num}_specs table`);
        table.innerHTML = '';
    });
}

        document.querySelectorAll('.shop-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productNumber = this.id.replace('product', '').replace('_btn', ''); // e.g., '1' from 'product1_btn'
                const productName = document.getElementById(`product${productNumber}`).value;
                getProductDetails(productName, productNumber);
            });
        });
        async function getProductDetails(productName, productNumber) {
            try {
                const detailsUrl = `{% url 'getDetails' 'NAME_PLACEHOLDER' %}`.replace('NAME_PLACEHOLDER', encodeURIComponent(productName.trim()));


                const response = await fetch(detailsUrl);
                const data = await response.json();

                if (data.error) {
                    console.error('Error fetching data:', data.error);
                    return;
                }

                document.getElementById(`product${productNumber}_img`).src = data.image;
                document.getElementById(`product${productNumber}_name`).textContent = data.name.toUpperCase();
                document.getElementById(`product${productNumber}_price`).textContent = data.price;

                const table = document.querySelector(`#product${productNumber}_specs table`);
                table.innerHTML = '';
                data.specs.forEach(spec => {
                    const key = Object.keys(spec)[0];
                    const value = spec[key];
                    
                    let row = table.insertRow();
                    
                    let cell1 = row.insertCell(0);
                    let div1 = document.createElement('div')
                    div1.classList.add('specsRow')
                    cell1.appendChild(div1)

                    div1.textContent = key.toUpperCase();
                    cell1.style.fontWeight = 'bold';



                    let cell2 = row.insertCell(1)
                    let div2 = document.createElement('div')
                    div2.classList.add('specsRow')
                    cell2.appendChild(div2)

                div2.innerHTML = value


                });
            } catch (error) {
                console.error('Error fetching details:', error);
            }
        }

    });
    </script>
 
       {% endblock body %}
   
   </html>

